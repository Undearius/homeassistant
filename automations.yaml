- id: movielights
  alias: 'Lights: Movie Lights'
  trigger:
  - platform: state
    from: playing
    to: paused
    entity_id: media_player.plex_umbriel
    id: paused
  - platform: state
    to: playing
    entity_id: media_player.plex_umbriel
    id: playing
  - platform: state
    from: playing
    to: idle
    entity_id: media_player.plex_umbriel
    id: ended
  - platform: state
    to: idle
    entity_id: media_player.plex_umbriel
    id: stopped
  condition:
  - condition: or
    conditions:
    - condition: state
      entity_id: media_player.plex_umbriel
      state: movie
      attribute: media_content_type
    - condition: state
      entity_id: media_player.plex_umbriel
      state: tvshow
      attribute: media_content_type
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: paused
      sequence:
      - service: light.turn_on
        data:
          brightness_pct: 1
        target:
          entity_id: light.livingroom_pots
    - conditions:
      - condition: or
        conditions:
        - condition: trigger
          id: ended
        - condition: trigger
          id: stopped
      sequence:
      - service: light.turn_on
        data:
          transition: 10
          brightness_pct: 30
        target:
          entity_id: light.livingroom_pots
    - conditions:
      - condition: trigger
        id: playing
      sequence:
      - service: light.turn_off
        target:
          entity_id: light.livingroom_pots
        data: {}
    default: []
- id: alistairmainirbrightness
  alias: Alistair Main IR Brightness
  trigger:
  - platform: state
    entity_id: input_number.alistair_main_ir
  action:
  - service: lifx.set_state
    entity_id: light.alistair_main
    data_template:
      infrared: '{{ states(''input_number.alistair_main_ir'') | int }}'
  initial_state: true
  mode: single
- id: '1598760479433'
  alias: Rowan Light off White Noise on
  description: ''
  trigger:
  - platform: device
    type: turned_off
    device_id: ec3547b4fd1a140b8125fedb3a35cf68
    entity_id: light.rowan_main
    domain: light
    id: Rowan
  condition:
  - condition: state
    state: 'on'
    entity_id: input_boolean.rowan_sound_trigger
    for:
      hours: 0
      minutes: 1
      seconds: 0
  action:
  - data:
      entity_id: media_player.rowan_room
    service: media_player.unjoin
  - data:
      volume_level: 0.07
    service: media_player.volume_set
    target:
      entity_id: media_player.rowan_room
  - data:
      entity_id: media_player.rowan_room
      source: Baby
    service: media_player.select_source
  - service: media_player.repeat_set
    data:
      repeat: one
    target:
      entity_id: media_player.rowan_room
  - type: turn_off
    device_id: ec3547b4fd1a140b8125fedb3a35cf68
    entity_id: light.rowan_main
    domain: light
  - service: light.turn_on
    data: {}
    target:
      entity_id: light.rowan_main_ir
  mode: single
- id: '1598804150280'
  alias: Light on White Noise off
  description: ''
  trigger:
  - entity_id: light.alistair_main
    platform: state
    id: Alistair
  - entity_id: light.rowan_main
    platform: state
    id: Rowan
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: Alistair
      - condition: template
        value_template: '{{ states.light.alistair_main.attributes.brightness > 10
          }}'
      - condition: state
        entity_id: light.alistair_main_ir
        for:
          minutes: 1
        state: 'on'
      sequence:
      - service: sonos.set_sleep_timer
        data:
          entity_id: media_player.alistair_room
          sleep_time: 0
      - service: light.turn_off
        data: {}
        target:
          entity_id: light.alistair_main_ir
    - conditions:
      - condition: trigger
        id: Rowan
      - condition: template
        value_template: '{{ states.light.rowan_main.attributes.brightness > 10 }}'
      - condition: state
        entity_id: light.rowan_main_ir
        for:
          minutes: 1
        state: 'on'
      sequence:
      - service: sonos.set_sleep_timer
        data:
          entity_id: media_player.rowan_room
          sleep_time: 0
      - service: light.turn_off
        data: {}
        target:
          entity_id: light.rowan_main_ir
  mode: single
- id: '1599327200195'
  alias: Sound Trigger off when brightness above 30%
  description: ''
  trigger:
  - entity_id: light.alistair_main
    platform: state
    id: Alistair
  - entity_id: light.rowan_main
    platform: state
    id: Rowan
  condition: []
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: Alistair
      - condition: template
        value_template: '{{ states.light.alistair_main.attributes.brightness > 85
          }}'
      sequence:
      - data: {}
        entity_id: input_boolean.alistair_sound_trigger
        service: input_boolean.turn_off
    - conditions:
      - condition: trigger
        id: Rowan
      - condition: template
        value_template: '{{ states.light.rowan_main.attributes.brightness > 85 }}'
      sequence:
      - data: {}
        entity_id: input_boolean.rowan_sound_trigger
        service: input_boolean.turn_off
  mode: single
- id: '1613327902048'
  alias: SaA Webhhok Kyle
  description: ''
  trigger:
  - platform: webhook
    webhook_id: sleepasandroidkyle
  condition: []
  action:
  - service: input_text.set_value
    data:
      value: '{{ trigger.json.event }}'
    entity_id: input_text.saa_kyle
  mode: single
- id: '1613330813566'
  alias: SaA Webhook Allynn
  description: ''
  trigger:
  - platform: webhook
    webhook_id: sleepasandroidallynn
  condition: []
  action:
  - service: input_text.set_value
    data:
      value: '{{ trigger.json.event }}'
    entity_id: input_text.saa_allynn
  mode: single
- id: '1614033386075'
  alias: Notify Kyle if music is playing while asleep
  description: ''
  trigger:
  - platform: state
    entity_id: media_player.living_room
    to: playing
  condition:
  - condition: not
    conditions:
    - condition: or
      conditions:
      - condition: state
        entity_id: input_text.saa_kyle
        state: sleep_tracking_stopped
      - condition: state
        entity_id: input_text.saa_kyle
        state: alarm_alert_dismiss
  action:
  - service: notify.mobile_app_oneplus5t
    data:
      message: A song was played while you were sleeping. Check Last.fm
      title: Music Scrobbled
      data:
        clickAction: https://last.fm/user/Undearius
  mode: single
- id: '1614033769366'
  alias: Notify Kyle if Allynn left her computer on
  description: ''
  trigger:
  - platform: state
    entity_id: input_text.saa_allynn
    to: sleep_tracking_started
  - platform: state
    entity_id: person.allynn
    from: home
  condition:
  - condition: state
    entity_id: device_tracker.allynnscomputer
    state: home
  action:
  - service: notify.mobile_app_oneplus5t
    data:
      title: Computer Running
      message: Allynn left her computer on. Shut it off.
  mode: single
- id: '1615074707979'
  alias: Notify if Thermostat becomes unavailable
  description: ''
  trigger:
  - platform: state
    entity_id: climate.thermostat
    to: unavailable
    for:
      hours: 0
      minutes: 1
      seconds: 0
  - platform: state
    entity_id: climate.thermostat
    attribute: current_temperature
    to: '0'
    for:
      hours: 0
      minutes: 0
      seconds: 30
  condition: []
  action:
  - service: notify.mobile_app_sm_a515w
    data:
      title: Thermostat Unavailable
      message: Check to see if the furnace is on!
      data:
        clickAction: /lovelace/climate
  - service: notify.mobile_app_oneplus5t
    data:
      title: Thermostat Unavailable
      message: Check to see if the furnace is on!
      data:
        clickAction: /lovelace/climate
  - service: notify.mobile_app_oneplus5t
    data:
      message: TTS
      title: Thermostat is offline
      data:
        channel: alarm_stream
  mode: single
- id: '1615075704978'
  alias: 'Lights: Morning Sunrise'
  description: ''
  trigger:
  - platform: time
    at: 06:45:00
  condition:
  - condition: time
    weekday:
    - mon
    - tue
    - wed
    - thu
    - fri
    before: 00:00:00
    after: 00:00:00
  - condition: or
    conditions:
    - condition: state
      entity_id: person.kyle
      state: home
    - condition: state
      entity_id: person.allynn
      state: home
  - condition: sun
    before: sunrise
  action:
  - service: script.turn_on
    target:
      entity_id: script.sunrise
    data:
      variables:
        light: light.wled_bed
  mode: single
- id: '1634020365562'
  alias: Let there be light
  description: Turn on all the lights in the kitchen/living room
  trigger:
  - platform: state
    entity_id: binary_sensor.in_wall_smart_motion_dimmer_home_security_motion_detection
    from: 'off'
    to: 'on'
  condition: []
  action:
  - service: light.turn_on
    target:
      entity_id:
      - light.livingroom_pots
      - light.dining_table
      - light.kitchen
      - light.living_room_main
      - light.sink_lights
    data:
      brightness_pct: 100
  mode: single
- id: '1637868774108'
  alias: Clock Chimes - Minutes
  description: ''
  trigger:
  - platform: time_pattern
    minutes: /15
  condition:
  - condition: template
    value_template: '{{ now().minute > 10 and now().minute < 50 }}'
  - condition: not
    conditions:
    - condition: state
      entity_id: media_player.living_room
      state: playing
  action:
  - data:
      entity_id: media_player.living_room
    service: sonos.unjoin
  - data:
      volume_level: 0.25
    service: media_player.volume_set
    target:
      entity_id: media_player.living_room
  - service: media_player.play_media
    data:
      media_content_id: x-file-cifs://10.0.0.10/docs/kyle/Documents/Projects/Clock
        Chimes/{{ now().minute }}.mp3
      media_content_type: music
    target:
      entity_id: media_player.living_room
  mode: single
- id: '1637870310658'
  alias: Clock Chimes - Hour
  description: ''
  trigger:
  - platform: time_pattern
    hours: '*'
    seconds: '39'
    minutes: '59'
  condition:
  - condition: time
    after: 06:50:00
    before: '21:05:00'
  - condition: not
    conditions:
    - condition: state
      entity_id: media_player.living_room
      state: playing
  action:
  - data:
      entity_id: media_player.living_room
    service: sonos.unjoin
  - data:
      volume_level: 0.25
    service: media_player.volume_set
    target:
      entity_id: media_player.living_room
  - service: media_player.clear_playlist
    target:
      entity_id: media_player.living_room
  - service: media_player.play_media
    data:
      media_content_id: x-file-cifs://10.0.0.10/docs/kyle/Documents/Projects/Clock
        Chimes/60.mp3
      media_content_type: music
      enqueue: true
    target:
      entity_id: media_player.living_room
  - service: media_player.play_media
    data:
      media_content_id: x-file-cifs://10.0.0.10/docs/kyle/Documents/Projects/Clock
        Chimes/{% if now().hour > 12 %}{{ now().hour - 11 }}{%- else -%}{{ now().hour
        + 1 }}{%- endif %}.mp3
      media_content_type: music
      enqueue: true
    target:
      entity_id: media_player.living_room
  - service: sonos.play_queue
    target:
      entity_id: media_player.living_room
  mode: single
- id: '1639164820573'
  alias: House shutoff when no one is home
  description: Lights off, Garage closed, Thermostat to away
  trigger:
  - platform: state
    entity_id: person.allynn
    to: not_home
  - platform: state
    entity_id: person.kyle
    to: not_home
  condition:
  - condition: state
    entity_id: person.allynn
    state: not_home
  - condition: state
    entity_id: person.kyle
    state: not_home
  - condition: not
    conditions:
    - condition: state
      entity_id: person.guest
      state: home
  action:
  - service: light.turn_off
    entity_id: all
  - device_id: 7eb71993650f9a57276a8f9e8fd99f6d
    domain: cover
    entity_id: cover.garage_door
    type: close
  - service: climate.set_preset_mode
    data:
      preset_mode: away
    target:
      entity_id: climate.thermostat
  mode: single
- id: '1641689543179'
  alias: 'Lights: Pots on motion'
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.living_room_dimmer_motion
    from: 'off'
    to: 'on'
  - platform: state
    entity_id: input_boolean.potsoverride
  condition:
  - condition: state
    entity_id: input_boolean.potsoverride
    state: 'off'
  - condition: template
    value_template: "{% if states('weather.ottawa_kanata_orleans') in [\"snowy\",\"cloudy\",\"rainy\"]
      %}\n  {% set ele = 7 %}\n{% else %}\n  {% set ele = 6 %}\n{% endif %}\n{{ state_attr('sun.sun',
      'elevation') < ele }}"
  - condition: or
    conditions:
    - condition: state
      entity_id: light.livingroom_pots
      state: 'on'
    - condition: state
      entity_id: light.livingroom_pots
      state: 'off'
      for:
        hours: 0
        minutes: 0
        seconds: 5
  action:
  - service: light.turn_on
    target:
      entity_id: light.livingroom_pots
    data:
      brightness_pct: "{% if is_state(\"light.livingroom_pots\", \"on\") -%}\n  {{
        (state_attr(\"light.livingroom_pots\", \"brightness\") / 2.55 ) | round }}\n{%-
        else -%}\n  {% if now().hour >=22 or now().hour < 7 %} 1\n  {% elif now().hour
        >= 20 and now().hour < 22 %} 20\n  {% else %} 100\n  {% endif %}\n{%- endif
        %}"
  - wait_template: '{{ is_state("binary_sensor.living_room_dimmer_motion", "off")
      }}'
  - delay:
      minutes: '{% if now().hour >=17 and now().hour < 22 %} 30 {% else %} 15 {% endif
        %}'
  - condition: state
    entity_id: input_boolean.potsoverride
    state: 'off'
  - service: light.turn_off
    target:
      entity_id: light.livingroom_pots
    data: {}
  mode: restart
- id: '1641781795297'
  alias: Notify Kyle if furnace about to turn on
  description: ''
  trigger:
  - platform: state
    entity_id: climate.thermostat
    attribute: current_temperature
    to: '21.2'
  condition: []
  action:
  - service: notify.mobile_app_oneplus5t
    data:
      message: Furnace is about to turn on
      title: 'Furnace '
  mode: single
- id: '1641799136107'
  alias: Sink lights on motion
  description: ''
  trigger:
  - platform: state
    entity_id: binary_sensor.living_room_dimmer_motion
    from: 'off'
    to: 'on'
  condition: []
  action:
  - service: light.turn_on
    target:
      entity_id: light.sink_lights
  - wait_template: '{{ is_state("binary_sensor.living_room_dimmer_motion", "off")
      }}'
  - service: light.turn_off
    target:
      entity_id: light.sink_lights
  mode: restart
- id: '1643432818705'
  alias: 'Lights: Kitchen light on'
  description: ''
  trigger:
  - platform: state
    entity_id: light.livingroom_pots
    to: 'on'
  condition:
  - condition: or
    conditions:
    - condition: time
      weekday:
      - mon
      - tue
      - wed
      - thu
      - fri
      after: '16:00:00'
      before: '19:00:00'
    - condition: time
      after: '17:00:00'
      before: '19:00:00'
      weekday:
      - sat
      - sun
    - condition: time
      after: 06:30:00
      before: 08:30:00
      weekday:
      - mon
      - tue
      - wed
      - thu
      - fri
  action:
  - service: light.turn_on
    target:
      entity_id: light.kitchen
    data: {}
  mode: single
- id: '1644961012560'
  alias: Power off workstation if idle
  description: ''
  trigger:
  - platform: numeric_state
    entity_id: sensor.kyle_office_outlet_power
    below: '30'
    for:
      hours: 0
      minutes: 5
      seconds: 0
    above: '0'
  condition: []
  action:
  - service: notify.mobile_app_oneplus5t
    data:
      message: Workstation power left on. Switching off in 5 minutes
      title: Workstation idling
  - delay:
      hours: 0
      minutes: 5
      seconds: 0
      milliseconds: 0
  - service: switch.turn_off
    data: {}
    target:
      entity_id: switch.kyle_office_outlet_relay
  mode: restart
- id: '1644967380579'
  alias: Power on workstation
  description: ''
  trigger:
  - platform: state
    entity_id:
    - person.kyle
    to: home
    for:
      hours: 0
      minutes: 0
      seconds: 40
  condition:
  - condition: state
    entity_id: binary_sensor.workday_sensor
    state: 'on'
  - condition: time
    before: 09:00:00
    after: 08:15:00
  action:
  - service: switch.turn_on
    data: {}
    target:
      entity_id: switch.kyle_office_outlet_relay
  mode: single
- id: '1645727158023'
  alias: 'Lights: Set porch scene'
  description: ''
  trigger:
  - platform: device
    type: turned_on
    device_id: 06efffd362e64ab2ab3d31b1b9a7536c
    entity_id: light.porch_door
    domain: light
  - platform: device
    type: turned_on
    device_id: 86eeede02253437d93516e7083c15338
    entity_id: light.porch_front
    domain: light
  - platform: device
    type: turned_on
    device_id: 7aebf5aee400c5e711739c9fe1445c40
    entity_id: light.porch_garage
    domain: light
  condition: []
  action:
  - choose:
    - conditions:
      - condition: template
        value_template: '{{ now().month == 7 and now().day == 1 }}'
      sequence:
      - service: scene.turn_on
        data: {}
        target:
          entity_id:
          - scene.porch_lights_canada
    - conditions:
      - condition: template
        value_template: '{{ now().month == 7 and now().day == 4 }}'
      sequence:
      - service: scene.turn_on
        data: {}
        target:
          entity_id:
          - scene.porch_lights_usa
    - conditions:
      - condition: template
        value_template: '{{ now().month == 10 }}'
      sequence:
      - service: scene.turn_on
        data: {}
        target:
          entity_id: scene.porch_lights_halloween
    - conditions:
      - condition: template
        value_template: '{{ now().month == 12 and now().day < 30 }}'
      sequence:
      - service: scene.turn_on
        data: {}
        target:
          entity_id:
          - scene.porch_lights_christmas
    default:
    - service: scene.turn_on
      data: {}
      target:
        entity_id: scene.porch_lights_ukraine
  mode: single
- id: '1645878364914'
  alias: Notify if motion in Alistair's room
  description: ''
  trigger:
  - platform: state
    for:
      hours: 0
      minutes: 1
      seconds: 0
    entity_id: binary_sensor.alistair_room_home_security_motion_detection
    from: 'off'
    to: 'on'
  condition:
  - condition: state
    state: 'on'
    entity_id: light.alistair_main_ir
  action:
  - service: notify.mobile_app_sm_a515w
    data:
      data:
        clickAction: /lovelace/alistair
      message: Something moved in Alistair's room
      title: He's awake!
  - service: notify.mobile_app_sm_a515w
    data:
      message: TTS
      data:
        channel: alarm_stream
      title: Alistair is out of bed
  - service: notify.mobile_app_oneplus5t
    data:
      data:
        clickAction: /lovelace/alistair
      message: Something moved in Alistair's room
      title: He's awake!
  - service: notify.mobile_app_oneplus5t
    data:
      message: TTS
      data:
        channel: alarm_stream
      title: Alistair is out of bed
  mode: single
- id: '1646622549758'
  alias: Climate Preset to Home
  description: ''
  trigger:
  - platform: state
    entity_id: person.allynn
    to: home
  - platform: state
    entity_id: person.kyle
    to: home
  - platform: template
    value_template: '{{ now().weekday() == 6 and now().hour == 9}}'
    id: Time
  condition:
  - condition: device
    device_id: 03340c90280e45fb5531642771532b70
    domain: climate
    entity_id: climate.thermostat
    type: is_preset_mode
    preset_mode: away
  action:
  - service: climate.set_preset_mode
    data:
      preset_mode: home
    target:
      entity_id: climate.thermostat
  mode: single
- id: '1647738110786'
  alias: Notify Kyle if Thermostat becomes unavailable
  description: ''
  trigger:
  - platform: state
    entity_id:
    - climate.thermostat
    to: unavailable
    for:
      hours: 0
      minutes: 0
      seconds: 0
  - platform: state
    entity_id: climate.thermostat
    attribute: current_temperature
    to: '0'
    for:
      hours: 0
      minutes: 0
      seconds: 1
  condition: []
  action:
  - service: notify.mobile_app_oneplus5t
    data:
      title: Thermostat Unavailable
      message: Check to see if the furnace is on!
      data:
        clickAction: /lovelace/climate
  - service: notify.mobile_app_oneplus5t
    data:
      message: TTS
      title: Thermostat is offline
      data:
        channel: alarm_stream
  mode: single
- id: '1650116919646'
  alias: 'Notify: Garage door open'
  description: ''
  trigger:
  - platform: device
    device_id: 7eb71993650f9a57276a8f9e8fd99f6d
    domain: cover
    entity_id: cover.garage_door
    type: opened
    for:
      hours: 1
      minutes: 0
      seconds: 0
  condition: []
  action:
  - service: script.1646789693540
    data: {}
  mode: single
- id: '1650118685335'
  alias: 'Notify: Allynn to water plants'
  description: ''
  trigger:
  - platform: time
    at: 07:30:00
  condition:
  - condition: time
    weekday:
    - sun
    before: '11:00:00'
    after: 07:00:00
  action:
  - service: notify.mobile_app_sm_a515w
    data:
      message: Water your damn plants!
      title: Water plants
  mode: single
- id: '1656953507090'
  alias: 'Climate: Toggle fan'
  description: ''
  trigger:
  - type: temperature
    platform: device
    device_id: 03340c90280e45fb5531642771532b70
    entity_id: sensor.thermostat_temperature
    domain: sensor
    id: Fanon
    above: 23
  - type: temperature
    platform: device
    device_id: 03340c90280e45fb5531642771532b70
    entity_id: sensor.thermostat_temperature
    domain: sensor
    below: 22.5
    id: Fanoff
  condition:
  - condition: device
    device_id: 03340c90280e45fb5531642771532b70
    domain: climate
    entity_id: climate.thermostat
    type: is_preset_mode
    preset_mode: home
  action:
  - choose:
    - conditions:
      - condition: trigger
        id: Fanon
      sequence:
      - service: climate.set_fan_mode
        data:
          fan_mode: 'On'
        target:
          entity_id: climate.thermostat
    - conditions:
      - condition: trigger
        id: Fanoff
      sequence:
      - service: climate.set_fan_mode
        data:
          fan_mode: 'Off'
        target:
          entity_id: climate.thermostat
    default: []
  mode: single
- id: '1663896073423'
  alias: Rowan Main IR Brightness
  description: ''
  trigger:
  - platform: state
    entity_id: input_number.rowan_main_ir
  condition: []
  action:
  - service: lifx.set_state
    entity_id: light.rowan_main
    data_template:
      infrared: '{{ states(''input_number.rowan_main_ir'') | int }}'
  mode: single
  initial_state: true
- id: '1664322732696'
  alias: Alistair Light off White noise on
  description: ''
  trigger:
  - platform: device
    type: turned_off
    device_id: 7baa77eeb6604448a7c10fb87d16a286
    entity_id: light.alistair_main
    domain: light
  condition:
  - condition: state
    state: 'on'
    entity_id: input_boolean.alistair_sound_trigger
    for:
      hours: 0
      minutes: 1
      seconds: 0
  action:
  - data:
      entity_id: media_player.alistair_room
    service: media_player.unjoin
  - data:
      entity_id: media_player.alistair_room
      volume_level: 0.13
    service: media_player.volume_set
  - data:
      entity_id: media_player.alistair_room
      source: Baby
    service: media_player.select_source
  - service: media_player.repeat_set
    data:
      repeat: one
    target:
      entity_id: media_player.alistair_room
  - type: turn_off
    device_id: ec3547b4fd1a140b8125fedb3a35cf68
    entity_id: light.rowan_main
    domain: light
  - service: light.turn_on
    data: {}
    target:
      entity_id: light.alistair_main_ir
  mode: single
